<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>SciKit-Learn 高斯混合模型</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
</head>
<body class="theme theme-white">
<div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_SVG_Hidden"></div><svg><defs id="MathJax_SVG_glyphs"><path d="M56 731Q56 740 62 745T75 750Q85 750 92 740Q96 733 270 255T444 -231Q444 -239 438 -244T424 -250Q414 -250 407 -240Q404 -236 230 242T56 731Z" stroke-width="1" id="MJMAIN-5C"></path><path d="M132 -11Q98 -11 98 22V33L111 61Q186 219 220 334L228 358H196Q158 358 142 355T103 336Q92 329 81 318T62 297T53 285Q51 284 38 284Q19 284 19 294Q19 300 38 329T93 391T164 429Q171 431 389 431Q549 431 553 430Q573 423 573 402Q573 371 541 360Q535 358 472 358H408L405 341Q393 269 393 222Q393 170 402 129T421 65T431 37Q431 20 417 5T381 -10Q370 -10 363 -7T347 17T331 77Q330 86 330 121Q330 170 339 226T357 318T367 358H269L268 354Q268 351 249 275T206 114T175 17Q164 -11 132 -11Z" stroke-width="1" id="MJMATHI-3C0"></path><path d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z" stroke-width="1" id="MJMATHI-6B"></path><path d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z" stroke-width="1" id="MJMATHI-4E"></path><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" stroke-width="1" id="MJMAIN-28"></path><path d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" stroke-width="1" id="MJMATHI-78"></path><path d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 85 94 103T137 121Q202 121 202 8Q202 -44 183 -94T144 -169T118 -194Q115 -194 106 -186T95 -174Q94 -171 107 -155T137 -107T160 -38Q161 -32 162 -22T165 -4T165 4Q165 5 161 4T142 0Q110 0 94 18T78 60Z" stroke-width="1" id="MJMAIN-3B"></path><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z" stroke-width="1" id="MJMATHI-75"></path><path d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" stroke-width="1" id="MJMAIN-2C"></path><path d="M666 247Q664 244 652 126T638 4V0H351Q131 0 95 0T57 5V6Q54 12 57 17L73 36Q89 54 121 90T182 159L305 299L56 644L55 658Q55 677 60 681Q63 683 351 683H638V679Q640 674 652 564T666 447V443H626V447Q618 505 604 543T559 605Q529 626 478 631T333 637H294H189L293 494Q314 465 345 422Q400 346 400 340Q400 338 399 337L154 57Q407 57 428 58Q476 60 508 68T551 83T575 103Q595 125 608 162T624 225L626 251H666V247Z" stroke-width="1" id="MJMAIN-3A3"></path><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" stroke-width="1" id="MJMAIN-29"></path></defs></svg></div><div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 id="scikit-learn-高斯混合模型" data-anchor-id="glhr">SciKit-Learn 高斯混合模型</h1><p data-anchor-id="mv6r"><code>SciKit-Learn</code> <code>GMM</code> <code>高斯混合模型</code><a href="../index.html" style="float:right"><strong>Home</strong></a></p><hr><div class="md-section-divider"></div><h3 id="内容目录" data-anchor-id="s5ak">内容目录</h3><p data-anchor-id="9veq"><div class="toc"><div class="toc">
<ul>
<li><a href="#scikit-learn-高斯混合模型">SciKit-Learn 高斯混合模型</a><ul>
<li><ul>
<li><a href="#内容目录">内容目录</a></li>
<li><a href="#模型介绍">模型介绍</a><ul>
<li><a href="#单高斯分布模型">单高斯分布模型</a></li>
<li><a href="#高斯混合模型">高斯混合模型</a></li>
</ul>
</li>
<li><a href="#高斯混合模型实例">高斯混合模型实例</a></li>
<li><a href="#如何确定高斯混合模型的component数量">如何确定高斯混合模型的component数量</a></li>
<li><a href="#使用高斯混合模型进行奇异值检测">使用高斯混合模型进行奇异值检测</a><ul>
<li><a href="#生成实验数据">生成实验数据</a></li>
<li><a href="#筛选奇异值">筛选奇异值</a></li>
</ul>
</li>
<li><a href="#其他密度估计方法">其他密度估计方法</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</p><div class="md-section-divider"></div><h3 id="模型介绍" data-anchor-id="ycan">模型介绍</h3><div class="md-section-divider"></div><h4 id="单高斯分布模型" data-anchor-id="w7bm">单高斯分布模型</h4><p data-anchor-id="nk2e">单高斯分布模型GSM多维变量X服从高斯分布时，它的概率密度函数PDF为： <br>
<img src="http://static.zybuluo.com/ronaldhan/yc1ltms2qxqrmo6d0g9bbs83/gsm.png" alt="gsm.png-4.3kB" title=""> <br>
x是维度为d的列向量，u是模型期望，Σ是模型方差。在实际应用中u通常用样本均值来代替，Σ通常用样本方差来代替。很容易判断一个样x本是否属于类别C。因为每个类别都有自己的u和Σ，把x代入（1）式，当概率大于一定阈值时我们就认为x属于C类。 <br>
从几何上讲，单高斯分布模型在二维空间应该近似于椭圆，在三维空间上近似于椭球。遗憾的是在很多分类问题中，属于同一类别的样本点并不满足“椭圆”分布的特性。这就引入了高斯混合模型。</p><div class="md-section-divider"></div><h4 id="高斯混合模型" data-anchor-id="mgcr">高斯混合模型</h4><p data-anchor-id="2vau">GMM认为数据是从几个GSM中生成出来的，K需要事先确定好。 <br>
<img src="http://static.zybuluo.com/ronaldhan/o8wvjsadx9m5yygqmwn59t7u/gmm.png" alt="gmm.png-3.5kB" title=""> <br>
<span class="MathJax_Preview"></span><span aria-readonly="true" role="textbox" id="MathJax-Element-20-Frame" class="MathJax_SVG" style="font-size: 100%; display: inline-block;"><svg viewBox="0 -452.0516853480245 1039.2561863887845 630.5886520702876" style="width: 2.432ex; height: 1.506ex; vertical-align: -0.463ex; margin: 1px 0px;" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="matrix(1 0 0 -1 0 0)" stroke-width="0" fill="black" stroke="black"><use xlink:href="#MJMATHI-3C0"></use><use y="-213" x="806" xlink:href="#MJMATHI-6B" transform="scale(0.7071067811865476)"></use></g></svg></span><script id="MathJax-Element-20" type="math/tex">π_k</script>是权值因子。其中的任意一个高斯分布<span class="MathJax_Preview"></span><span aria-readonly="true" role="textbox" id="MathJax-Element-21-Frame" class="MathJax_SVG" style="font-size: 100%; display: inline-block;"><svg viewBox="0 -771.0516853480245 5362.845706110902 1042.103370696049" style="width: 12.51ex; height: 2.432ex; vertical-align: -0.695ex; margin: 1px 0px;" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="matrix(1 0 0 -1 0 0)" stroke-width="0" fill="black" stroke="black"><use xlink:href="#MJMATHI-4E"></use><use y="0" x="888" xlink:href="#MJMAIN-28"></use><use y="0" x="1278" xlink:href="#MJMATHI-78"></use><use y="0" x="1850" xlink:href="#MJMAIN-3B"></use><g transform="translate(2295,0)"><use xlink:href="#MJMATHI-75"></use><use y="-213" x="809" xlink:href="#MJMATHI-6B" transform="scale(0.7071067811865476)"></use></g><use y="0" x="3336" xlink:href="#MJMAIN-2C"></use><g transform="translate(3782,0)"><use xlink:href="#MJMAIN-3A3"></use><use y="-213" x="1021" xlink:href="#MJMATHI-6B" transform="scale(0.7071067811865476)"></use></g><use y="0" x="4973" xlink:href="#MJMAIN-29"></use></g></svg></span><script id="MathJax-Element-21" type="math/tex">N(x;u_k,Σ_k)</script>叫作这个模型的一个component。这里有个问题，为什么我们要假设数据是由若干个高斯分布组合而成的，而不假设是其他分布呢？实际上不管是什么分布，只K取得足够大，混合模型就会变得足够复杂，就可以用来逼近任意连续的概率密度分布。只是因为高斯函数具有良好的计算性能，所GMM被广泛地应用。</p><div class="md-section-divider"></div><h3 id="高斯混合模型实例" data-anchor-id="cpqm">高斯混合模型实例</h3><p data-anchor-id="959d">首先导入画图的各种包</p><div class="md-section-divider"></div><pre style="" data-anchor-id="qmt2" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">%</span><span class="pln">matplotlib inline</span></code></li><li class="L1"><code class="language-python"><span class="kwd">import</span><span class="pln"> numpy </span><span class="kwd">as</span><span class="pln"> np</span></code></li><li class="L2"><code class="language-python"><span class="kwd">import</span><span class="pln"> matplotlib</span><span class="pun">.</span><span class="pln">pyplot </span><span class="kwd">as</span><span class="pln"> plt</span></code></li><li class="L3"><code class="language-python"><span class="kwd">from</span><span class="pln"> scipy </span><span class="kwd">import</span><span class="pln"> stats</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="com"># use seaborn plotting defaults</span></code></li><li class="L6"><code class="language-python"><span class="kwd">import</span><span class="pln"> seaborn </span><span class="kwd">as</span><span class="pln"> sns</span><span class="pun">;</span><span class="pln"> sns</span><span class="pun">.</span><span class="pln">set</span><span class="pun">()</span></code></li></ol></pre><p data-anchor-id="gkfb">假设我们有一维的数据满足特定的分布：</p><div class="md-section-divider"></div><pre style="" data-anchor-id="azg6" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="com"># 利用三个标准分布混合出实验数据</span></code></li><li class="L1"><code class="language-python"><span class="pln">np</span><span class="pun">.</span><span class="pln">random</span><span class="pun">.</span><span class="pln">seed</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></code></li><li class="L2"><code class="language-python"><span class="pln">x </span><span class="pun">=</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">concatenate</span><span class="pun">([</span><span class="pln">np</span><span class="pun">.</span><span class="pln">random</span><span class="pun">.</span><span class="pln">normal</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2000</span><span class="pun">),</span></code></li><li class="L3"><code class="language-python"><span class="pln">                    np</span><span class="pun">.</span><span class="pln">random</span><span class="pun">.</span><span class="pln">normal</span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2000</span><span class="pun">),</span></code></li><li class="L4"><code class="language-python"><span class="pln">                    np</span><span class="pun">.</span><span class="pln">random</span><span class="pun">.</span><span class="pln">normal</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">600</span><span class="pun">)])</span></code></li><li class="L5"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">hist</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="lit">80</span><span class="pun">,</span><span class="pln"> normed</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">xlim</span><span class="pun">(-</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="jc7h"><img src="http://static.zybuluo.com/ronaldhan/vxrtbmrhyjhga32lyosi9dmn/output_4_0.png" alt="output_4_0.png-7.1kB" title=""> <br>
高斯混合模型能够刻画这种数据分布</p><div class="md-section-divider"></div><pre style="" data-anchor-id="r3gr" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">from</span><span class="pln"> sklearn</span><span class="pun">.</span><span class="pln">mixture </span><span class="kwd">import</span><span class="pln"> GMM</span></code></li><li class="L1"><code class="language-python"><span class="com"># 4表示component个数</span></code></li><li class="L2"><code class="language-python"><span class="pln">clf </span><span class="pun">=</span><span class="pln"> GMM</span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> n_iter</span><span class="pun">=</span><span class="lit">500</span><span class="pun">,</span><span class="pln"> random_state</span><span class="pun">=</span><span class="lit">3</span><span class="pun">).</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span></code></li><li class="L3"><code class="language-python"><span class="pln">xpdf </span><span class="pun">=</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">linspace</span><span class="pun">(-</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">density </span><span class="pun">=</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">exp</span><span class="pun">(</span><span class="pln">clf</span><span class="pun">.</span><span class="pln">score</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">))</span></code></li><li class="L5"><code class="language-python"></code></li><li class="L6"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">hist</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="lit">80</span><span class="pun">,</span><span class="pln"> normed</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> alpha</span><span class="pun">=</span><span class="lit">0.5</span><span class="pun">)</span></code></li><li class="L7"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">,</span><span class="pln"> density</span><span class="pun">,</span><span class="pln"> </span><span class="str">'-r'</span><span class="pun">)</span></code></li><li class="L8"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">xlim</span><span class="pun">(-</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="4flh"><img src="http://static.zybuluo.com/ronaldhan/q2vf6icg62k16qrv19mqb3jc/output_6_0.png" alt="output_6_0.png-18kB" title=""> <br>
可以看出模型很好地刻画了数据的分布，clf代表高斯混合模型，我们可以检查下模型的几个基本属性<code>means_</code>, <code>covars_</code>, 和 <code>weights_</code> 。</p><div class="md-section-divider"></div><pre style="" data-anchor-id="893y" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">clf</span><span class="pun">.</span><span class="pln">means_</span></code></li><li class="L1"><code class="language-python"><span class="pln">array</span><span class="pun">([[</span><span class="pln"> </span><span class="lit">4.5601338</span><span class="pln"> </span><span class="pun">],</span></code></li><li class="L2"><code class="language-python"><span class="pln">       </span><span class="pun">[</span><span class="pln"> </span><span class="lit">0.0861325</span><span class="pln"> </span><span class="pun">],</span></code></li><li class="L3"><code class="language-python"><span class="pln">       </span><span class="pun">[</span><span class="pln"> </span><span class="lit">3.01890623</span><span class="pun">],</span></code></li><li class="L4"><code class="language-python"><span class="pln">       </span><span class="pun">[</span><span class="pln"> </span><span class="lit">6.87627234</span><span class="pun">]])</span></code></li><li class="L5"><code class="language-python"></code></li><li class="L6"><code class="language-python"><span class="pln">clf</span><span class="pun">.</span><span class="pln">covars_</span></code></li><li class="L7"><code class="language-python"><span class="pln">array</span><span class="pun">([[</span><span class="pln"> </span><span class="lit">30.34748627</span><span class="pun">],</span></code></li><li class="L8"><code class="language-python"><span class="pln">       </span><span class="pun">[</span><span class="pln">  </span><span class="lit">4.30521863</span><span class="pun">],</span></code></li><li class="L9"><code class="language-python"><span class="pln">       </span><span class="pun">[</span><span class="pln">  </span><span class="lit">0.19750802</span><span class="pun">],</span></code></li><li class="L0"><code class="language-python"><span class="pln">       </span><span class="pun">[</span><span class="pln"> </span><span class="lit">14.78230876</span><span class="pun">]])</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="pln">clf</span><span class="pun">.</span><span class="pln">weights_</span></code></li><li class="L3"><code class="language-python"><span class="pln">array</span><span class="pun">([</span><span class="pln"> </span><span class="lit">0.27613209</span><span class="pun">,</span><span class="pln">  </span><span class="lit">0.48308463</span><span class="pun">,</span><span class="pln">  </span><span class="lit">0.11612442</span><span class="pun">,</span><span class="pln">  </span><span class="lit">0.12465886</span><span class="pun">])</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">hist</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="lit">80</span><span class="pun">,</span><span class="pln"> normed</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> alpha</span><span class="pun">=</span><span class="lit">0.3</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">,</span><span class="pln"> density</span><span class="pun">,</span><span class="pln"> </span><span class="str">'-r'</span><span class="pun">)</span></code></li><li class="L7"><code class="language-python"></code></li><li class="L8"><code class="language-python"><span class="com"># 刻画出每个compont</span></code></li><li class="L9"><code class="language-python"><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">clf</span><span class="pun">.</span><span class="pln">n_components</span><span class="pun">):</span></code></li><li class="L0"><code class="language-python"><span class="pln">    pdf </span><span class="pun">=</span><span class="pln"> clf</span><span class="pun">.</span><span class="pln">weights_</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> stats</span><span class="pun">.</span><span class="pln">norm</span><span class="pun">(</span><span class="pln">clf</span><span class="pun">.</span><span class="pln">means_</span><span class="pun">[</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">],</span></code></li><li class="L1"><code class="language-python"><span class="pln">                                       np</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(</span><span class="pln">clf</span><span class="pun">.</span><span class="pln">covars_</span><span class="pun">[</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">])).</span><span class="pln">pdf</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">)</span></code></li><li class="L2"><code class="language-python"><span class="pln">    plt</span><span class="pun">.</span><span class="pln">fill</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">,</span><span class="pln"> pdf</span><span class="pun">,</span><span class="pln"> facecolor</span><span class="pun">=</span><span class="str">'gray'</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"><span class="pln">             edgecolor</span><span class="pun">=</span><span class="str">'none'</span><span class="pun">,</span><span class="pln"> alpha</span><span class="pun">=</span><span class="lit">0.3</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">xlim</span><span class="pun">(-</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pun">)</span></code></li></ol></pre><p data-anchor-id="8pb2"><img src="http://static.zybuluo.com/ronaldhan/jmdrltekrpn5f9px3ap7a1we/output_11_0.png" alt="output_11_0.png-23.9kB" title=""></p><div class="md-section-divider"></div><h3 id="如何确定高斯混合模型的component数量" data-anchor-id="9vbz">如何确定高斯混合模型的component数量</h3><p data-anchor-id="qnbg">对于一个给定的模型，有多种方式来评估模型对数据的拟合情况。Aikaki Information Criterion (AIC)和the Bayesian Information Criterion (BIC)便是可以使用的标准，这两个标准的值越低，表明模型的质量越好。</p><div class="md-section-divider"></div><pre style="" data-anchor-id="e52g" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="com"># 针对上述模型</span></code></li><li class="L1"><code class="language-python"><span class="kwd">print</span><span class="pun">(</span><span class="pln">clf</span><span class="pun">.</span><span class="pln">bic</span><span class="pun">(</span><span class="pln">x</span><span class="pun">))</span></code></li><li class="L2"><code class="language-python"><span class="kwd">print</span><span class="pun">(</span><span class="pln">clf</span><span class="pun">.</span><span class="pln">aic</span><span class="pun">(</span><span class="pln">x</span><span class="pun">))</span></code></li><li class="L3"><code class="language-python"></code></li><li class="L4"><code class="language-python"><span class="lit">25696.4735953</span></code></li><li class="L5"><code class="language-python"><span class="lit">25625.7016679</span></code></li></ol></pre><p data-anchor-id="r73a">我们来观察随着component数量变化时这两个指标的变化情况</p><div class="md-section-divider"></div><pre style="" data-anchor-id="jdhm" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">n_estimators </span><span class="pun">=</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">arange</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">)</span></code></li><li class="L1"><code class="language-python"><span class="pln">clfs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">GMM</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> n_iter</span><span class="pun">=</span><span class="lit">1000</span><span class="pun">).</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> n </span><span class="kwd">in</span><span class="pln"> n_estimators</span><span class="pun">]</span></code></li><li class="L2"><code class="language-python"><span class="pln">bics </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">clf</span><span class="pun">.</span><span class="pln">bic</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> clf </span><span class="kwd">in</span><span class="pln"> clfs</span><span class="pun">]</span></code></li><li class="L3"><code class="language-python"><span class="pln">aics </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">clf</span><span class="pun">.</span><span class="pln">aic</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> clf </span><span class="kwd">in</span><span class="pln"> clfs</span><span class="pun">]</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">n_estimators</span><span class="pun">,</span><span class="pln"> bics</span><span class="pun">,</span><span class="pln"> label</span><span class="pun">=</span><span class="str">'BIC'</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">n_estimators</span><span class="pun">,</span><span class="pln"> aics</span><span class="pun">,</span><span class="pln"> label</span><span class="pun">=</span><span class="str">'AIC'</span><span class="pun">)</span></code></li><li class="L7"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">legend</span><span class="pun">();</span></code></li></ol></pre><p data-anchor-id="xxun"><img src="http://static.zybuluo.com/ronaldhan/l4mc0m7qkf41zpf0tq2wgabw/output_16_0.png" alt="output_16_0.png-15.3kB" title=""> <br>
从图中可以发现，无论使用哪个标准，component=4都是最好的选择。</p><div class="md-section-divider"></div><h3 id="使用高斯混合模型进行奇异值检测" data-anchor-id="38s1">使用高斯混合模型进行奇异值检测</h3><p data-anchor-id="4f8q">高斯混合模型是一种<strong>生成式模型</strong>，该模型对观察序列的联合概率分布p(x,y)建模，在获取联合概率分布之后，可以通过贝叶斯公式得到条件概率分布。 <br>
生成式模型可以用来进行奇异值检测，我们估计每个点出现的概率，概率低于阈值的点被称为奇异值。</p><div class="md-section-divider"></div><h4 id="生成实验数据" data-anchor-id="vvz8">生成实验数据</h4><div class="md-section-divider"></div><pre style="" data-anchor-id="4tl6" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">np</span><span class="pun">.</span><span class="pln">random</span><span class="pun">.</span><span class="pln">seed</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="com"># Add 20 outliers</span></code></li><li class="L3"><code class="language-python"><span class="pln">true_outliers </span><span class="pun">=</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">(</span><span class="pln">np</span><span class="pun">.</span><span class="pln">random</span><span class="pun">.</span><span class="pln">randint</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">x</span><span class="pun">),</span><span class="pln"> </span><span class="lit">20</span><span class="pun">))</span></code></li><li class="L4"><code class="language-python"><span class="pln">y </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">()</span></code></li><li class="L5"><code class="language-python"><span class="pln">y</span><span class="pun">[</span><span class="pln">true_outliers</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">50</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">random</span><span class="pun">.</span><span class="pln">randn</span><span class="pun">(</span><span class="lit">20</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"></code></li><li class="L7"><code class="language-python"></code></li><li class="L8"><code class="language-python"><span class="pln">clf </span><span class="pun">=</span><span class="pln"> GMM</span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> n_iter</span><span class="pun">=</span><span class="lit">500</span><span class="pun">,</span><span class="pln"> random_state</span><span class="pun">=</span><span class="lit">0</span><span class="pun">).</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)</span></code></li><li class="L9"><code class="language-python"><span class="pln">xpdf </span><span class="pun">=</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">linspace</span><span class="pun">(-</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000</span><span class="pun">)</span></code></li><li class="L0"><code class="language-python"><span class="pln">density_noise </span><span class="pun">=</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">exp</span><span class="pun">(</span><span class="pln">clf</span><span class="pun">.</span><span class="pln">score</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">))</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">hist</span><span class="pun">(</span><span class="pln">y</span><span class="pun">,</span><span class="pln"> </span><span class="lit">80</span><span class="pun">,</span><span class="pln"> normed</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> alpha</span><span class="pun">=</span><span class="lit">0.5</span><span class="pun">)</span></code></li><li class="L3"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">,</span><span class="pln"> density_noise</span><span class="pun">,</span><span class="pln"> </span><span class="str">'-r'</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="com">#plt.xlim(-10, 20);</span></code></li></ol></pre><p data-anchor-id="5uim"><img src="http://static.zybuluo.com/ronaldhan/gazs0thwyhmzxuqg1p7plxrp/output_20_0.png" alt="output_20_0.png-11.3kB" title=""></p><div class="md-section-divider"></div><h4 id="筛选奇异值" data-anchor-id="xce1">筛选奇异值</h4><p data-anchor-id="4b15">接下来将生成的数据作为模型的输入，计算对应的概率值<code>y</code></p><div class="md-section-divider"></div><pre style="" data-anchor-id="42yw" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">log_likelihood </span><span class="pun">=</span><span class="pln"> clf</span><span class="pun">.</span><span class="pln">score_samples</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)[</span><span class="lit">0</span><span class="pun">]</span></code></li><li class="L1"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">y</span><span class="pun">,</span><span class="pln"> log_likelihood</span><span class="pun">,</span><span class="pln"> </span><span class="str">'.k'</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="kozy"><img src="http://static.zybuluo.com/ronaldhan/amn2eix239vc3p3r5r4imvqm/output_22_0.png" alt="output_22_0.png-6.1kB" title=""></p><p data-anchor-id="3a8h">将log_likelihood较小的值筛选出来</p><div class="md-section-divider"></div><pre style="" data-anchor-id="kpmn" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">detected_outliers </span><span class="pun">=</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">where</span><span class="pun">(</span><span class="pln">log_likelihood </span><span class="pun">&lt;</span><span class="pln"> </span><span class="pun">-</span><span class="lit">9</span><span class="pun">)[</span><span class="lit">0</span><span class="pun">]</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="kwd">print</span><span class="pun">(</span><span class="str">"true outliers:"</span><span class="pun">)</span></code></li><li class="L3"><code class="language-python"><span class="kwd">print</span><span class="pun">(</span><span class="pln">true_outliers</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="kwd">print</span><span class="pun">(</span><span class="str">"\ndetected outliers:"</span><span class="pun">)</span></code></li><li class="L5"><code class="language-python"><span class="kwd">print</span><span class="pun">(</span><span class="pln">detected_outliers</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"></code></li><li class="L7"><code class="language-python"><span class="pln">true outliers</span><span class="pun">:</span></code></li><li class="L8"><code class="language-python"><span class="pun">[</span><span class="pln">  </span><span class="lit">99</span><span class="pln">  </span><span class="lit">537</span><span class="pln">  </span><span class="lit">705</span><span class="pln"> </span><span class="lit">1033</span><span class="pln"> </span><span class="lit">1653</span><span class="pln"> </span><span class="lit">1701</span><span class="pln"> </span><span class="lit">1871</span><span class="pln"> </span><span class="lit">2046</span><span class="pln"> </span><span class="lit">2135</span><span class="pln"> </span><span class="lit">2163</span><span class="pln"> </span><span class="lit">2222</span><span class="pln"> </span><span class="lit">2496</span><span class="pln"> </span><span class="lit">2599</span><span class="pln"> </span><span class="lit">2607</span><span class="pln"> </span><span class="lit">2732</span></code></li><li class="L9"><code class="language-python"><span class="pln"> </span><span class="lit">2893</span><span class="pln"> </span><span class="lit">2897</span><span class="pln"> </span><span class="lit">3264</span><span class="pln"> </span><span class="lit">3468</span><span class="pln"> </span><span class="lit">4373</span><span class="pun">]</span></code></li><li class="L0"><code class="language-python"></code></li><li class="L1"><code class="language-python"><span class="pln">detected outliers</span><span class="pun">:</span></code></li><li class="L2"><code class="language-python"><span class="pun">[</span><span class="pln"> </span><span class="lit">537</span><span class="pln">  </span><span class="lit">705</span><span class="pln"> </span><span class="lit">1653</span><span class="pln"> </span><span class="lit">2046</span><span class="pln"> </span><span class="lit">2135</span><span class="pln"> </span><span class="lit">2163</span><span class="pln"> </span><span class="lit">2496</span><span class="pln"> </span><span class="lit">2732</span><span class="pln"> </span><span class="lit">2893</span><span class="pln"> </span><span class="lit">2897</span><span class="pln"> </span><span class="lit">3067</span><span class="pln"> </span><span class="lit">3468</span><span class="pln"> </span><span class="lit">4373</span><span class="pun">]</span></code></li></ol></pre><p data-anchor-id="a29p">可以看到，并没有检测到所有的奇异值，没有判别出来的奇异值包括</p><div class="md-section-divider"></div><pre style="" data-anchor-id="gtap" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">set</span><span class="pun">(</span><span class="pln">true_outliers</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> set</span><span class="pun">(</span><span class="pln">detected_outliers</span><span class="pun">)</span></code></li><li class="L1"><code class="language-python"><span class="pun">{</span><span class="lit">99</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1033</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1701</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1871</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2222</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2599</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2607</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3264</span><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="qlia">还出现了将正常值判别为奇异值的情况</p><div class="md-section-divider"></div><pre style="" data-anchor-id="1l0y" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">set</span><span class="pun">(</span><span class="pln">detected_outliers</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> set</span><span class="pun">(</span><span class="pln">true_outliers</span><span class="pun">)</span></code></li><li class="L1"><code class="language-python"><span class="pun">{</span><span class="lit">3067</span><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h3 id="其他密度估计方法" data-anchor-id="8qtq">其他密度估计方法</h3><p data-anchor-id="f3p5">高斯混合模型可以用来进行密度估计，另外一个能够完成此任务的是<em>核密度估计</em>，可以在<code>sklearn.neighbors.KernelDensity</code>中调用。某种意义上说，核密度估计是高斯混合模型的泛化。</p><div class="md-section-divider"></div><pre style="" data-anchor-id="zswl" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">from</span><span class="pln"> sklearn</span><span class="pun">.</span><span class="pln">neighbors </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">KernelDensity</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="pln">kde </span><span class="pun">=</span><span class="pln"> </span><span class="typ">KernelDensity</span><span class="pun">(</span><span class="lit">0.15</span><span class="pun">).</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">x</span><span class="pun">[:,</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">])</span></code></li><li class="L3"><code class="language-python"><span class="pln">density_kde </span><span class="pun">=</span><span class="pln"> np</span><span class="pun">.</span><span class="pln">exp</span><span class="pun">(</span><span class="pln">kde</span><span class="pun">.</span><span class="pln">score_samples</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">[:,</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">]))</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">hist</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="lit">80</span><span class="pun">,</span><span class="pln"> normed</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> alpha</span><span class="pun">=</span><span class="lit">0.5</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">,</span><span class="pln"> density</span><span class="pun">,</span><span class="pln"> </span><span class="str">'-b'</span><span class="pun">,</span><span class="pln"> label</span><span class="pun">=</span><span class="str">'GMM'</span><span class="pun">)</span></code></li><li class="L7"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">xpdf</span><span class="pun">,</span><span class="pln"> density_kde</span><span class="pun">,</span><span class="pln"> </span><span class="str">'-r'</span><span class="pun">,</span><span class="pln"> label</span><span class="pun">=</span><span class="str">'KDE'</span><span class="pun">)</span></code></li><li class="L8"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">xlim</span><span class="pun">(-</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pun">)</span></code></li><li class="L9"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">legend</span><span class="pun">();</span></code></li></ol></pre><p data-anchor-id="0476"><img src="http://static.zybuluo.com/ronaldhan/4svpicwwa883kfi4qtzv1uuw/output_30_0.png" alt="output_30_0.png-24.3kB" title=""> <br>
所有的这些密度估计方法都是<strong>生成式模型</strong>，也就是说，根据这些模型，我们能生成更多符合模型的数据。</p><p data-anchor-id="7qbl">参考： <br>
<a target="_blank" href="https://github.com/jakevdp/sklearn_pycon2015">PyCon 2015 Scikit-learn Tutorial</a> <br>
<a target="_blank" href="http://scikit-learn.org/stable/modules/generated/sklearn.mixture.GMM.html">高斯混合模型</a></p></div>
</body>
</html>