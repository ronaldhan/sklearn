<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>SciKit-Learn k-means cluster</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 id="scikit-learn-k-means-cluster" data-anchor-id="12pd">SciKit-Learn k-means cluster</h1><p data-anchor-id="ec99"><code>SciKit-Learn</code> <code>k-means</code><a href="../index.html" style="float:right"><strong>Home</strong></a></p><hr><p data-anchor-id="r8ja">k-means聚类算法是常用的非监督分类算法，仅仅根据数据的属性进行聚类。下面看下在scikit-learn中如何进行k-means聚类。</p><div class="md-section-divider"></div><h3 id="k-means聚类" data-anchor-id="gjb0">k-means聚类</h3><div class="md-section-divider"></div><pre style="" data-anchor-id="aoj9" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="com"># 可视化包</span></code></li><li class="L1"><code class="language-python"><span class="pun">%</span><span class="pln">matplotlib inline</span></code></li><li class="L2"><code class="language-python"><span class="kwd">import</span><span class="pln"> numpy </span><span class="kwd">as</span><span class="pln"> np</span></code></li><li class="L3"><code class="language-python"><span class="kwd">import</span><span class="pln"> matplotlib</span><span class="pun">.</span><span class="pln">pyplot </span><span class="kwd">as</span><span class="pln"> plt</span></code></li><li class="L4"><code class="language-python"><span class="kwd">import</span><span class="pln"> seaborn</span><span class="pun">;</span><span class="pln"> </span></code></li><li class="L5"><code class="language-python"><span class="kwd">from</span><span class="pln"> sklearn</span><span class="pun">.</span><span class="pln">linear_model </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">LinearRegression</span></code></li><li class="L6"><code class="language-python"><span class="kwd">from</span><span class="pln"> scipy </span><span class="kwd">import</span><span class="pln"> stats</span></code></li><li class="L7"><code class="language-python"><span class="kwd">import</span><span class="pln"> pylab </span><span class="kwd">as</span><span class="pln"> pl</span></code></li><li class="L8"><code class="language-python"></code></li><li class="L9"><code class="language-python"><span class="pln">seaborn</span><span class="pun">.</span><span class="pln">set</span><span class="pun">()</span></code></li></ol></pre><div class="md-section-divider"></div><pre style="" data-anchor-id="m1ea" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">from</span><span class="pln"> sklearn </span><span class="kwd">import</span><span class="pln"> neighbors</span><span class="pun">,</span><span class="pln"> datasets</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="com"># 加载iris数据集</span></code></li><li class="L3"><code class="language-python"><span class="pln">iris </span><span class="pun">=</span><span class="pln"> datasets</span><span class="pun">.</span><span class="pln">load_iris</span><span class="pun">()</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="pln">X</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> iris</span><span class="pun">.</span><span class="pln">data</span><span class="pun">,</span><span class="pln"> iris</span><span class="pun">.</span><span class="pln">target</span></code></li><li class="L6"><code class="language-python"><span class="kwd">from</span><span class="pln"> sklearn</span><span class="pun">.</span><span class="pln">decomposition </span><span class="kwd">import</span><span class="pln"> PCA</span></code></li><li class="L7"><code class="language-python"><span class="com"># 降维处理，生成2维数据</span></code></li><li class="L8"><code class="language-python"><span class="pln">pca </span><span class="pun">=</span><span class="pln"> PCA</span><span class="pun">(</span><span class="pln">n_components</span><span class="pun">=</span><span class="lit">2</span><span class="pun">)</span></code></li><li class="L9"><code class="language-python"><span class="pln">pca</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">X</span><span class="pun">)</span></code></li><li class="L0"><code class="language-python"><span class="pln">X_reduced </span><span class="pun">=</span><span class="pln"> pca</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">X</span><span class="pun">)</span></code></li><li class="L1"><code class="language-python"><span class="kwd">print</span><span class="pun">(</span><span class="str">"Reduced dataset shape:"</span><span class="pun">,</span><span class="pln"> X_reduced</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">)</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="kwd">import</span><span class="pln"> pylab </span><span class="kwd">as</span><span class="pln"> pl</span></code></li><li class="L4"><code class="language-python"><span class="pln">pl</span><span class="pun">.</span><span class="pln">scatter</span><span class="pun">(</span><span class="pln">X_reduced</span><span class="pun">[:,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">],</span><span class="pln"> X_reduced</span><span class="pun">[:,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> c</span><span class="pun">=</span><span class="pln">y</span><span class="pun">,</span></code></li><li class="L5"><code class="language-python"><span class="pln">           cmap</span><span class="pun">=</span><span class="str">'RdYlBu'</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"></code></li><li class="L7"><code class="language-python"><span class="kwd">print</span><span class="pun">(</span><span class="str">"Meaning of the 2 components:"</span><span class="pun">)</span></code></li><li class="L8"><code class="language-python"><span class="kwd">for</span><span class="pln"> component </span><span class="kwd">in</span><span class="pln"> pca</span><span class="pun">.</span><span class="pln">components_</span><span class="pun">:</span></code></li><li class="L9"><code class="language-python"><span class="pln">    </span><span class="kwd">print</span><span class="pun">(</span><span class="str">" + "</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">"%.3f x %s"</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">)</span></code></li><li class="L0"><code class="language-python"><span class="pln">                     </span><span class="kwd">for</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> name </span><span class="kwd">in</span><span class="pln"> zip</span><span class="pun">(</span><span class="pln">component</span><span class="pun">,</span></code></li><li class="L1"><code class="language-python"><span class="pln">                                            iris</span><span class="pun">.</span><span class="pln">feature_names</span><span class="pun">)))</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pun">(</span><span class="str">'Reduced dataset shape:'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="lit">150L</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2L</span><span class="pun">))</span></code></li><li class="L4"><code class="language-python"><span class="typ">Meaning</span><span class="pln"> of the </span><span class="lit">2</span><span class="pln"> components</span><span class="pun">:</span></code></li><li class="L5"><code class="language-python"><span class="lit">0.362</span><span class="pln"> x sepal length </span><span class="pun">(</span><span class="pln">cm</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">-</span><span class="lit">0.082</span><span class="pln"> x sepal width </span><span class="pun">(</span><span class="pln">cm</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">0.857</span><span class="pln"> x petal length </span><span class="pun">(</span><span class="pln">cm</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">0.359</span><span class="pln"> x petal width </span><span class="pun">(</span><span class="pln">cm</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"><span class="pun">-</span><span class="lit">0.657</span><span class="pln"> x sepal length </span><span class="pun">(</span><span class="pln">cm</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">-</span><span class="lit">0.730</span><span class="pln"> x sepal width </span><span class="pun">(</span><span class="pln">cm</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">0.176</span><span class="pln"> x petal length </span><span class="pun">(</span><span class="pln">cm</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">0.075</span><span class="pln"> x petal width </span><span class="pun">(</span><span class="pln">cm</span><span class="pun">)</span></code></li></ol></pre><p data-anchor-id="hidk"><img src="http://static.zybuluo.com/ronaldhan/ieg0kdghdxj74nncpn18mcg4/output_4_1.png" alt="output_4_1.png-22.2kB" title=""></p><div class="md-section-divider"></div><pre style="" data-anchor-id="13cz" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">print</span><span class="pln"> X_reduced</span><span class="pun">.</span><span class="pln">shape</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="com"># 转换后生成数据的shape</span></code></li><li class="L3"><code class="language-python"><span class="pun">(</span><span class="lit">150L</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2L</span><span class="pun">)</span></code></li></ol></pre><div class="md-section-divider"></div><pre style="" data-anchor-id="6gnz" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="com"># 对经过PCA转换后的数据进行聚类</span></code></li><li class="L1"><code class="language-python"><span class="kwd">from</span><span class="pln"> sklearn</span><span class="pun">.</span><span class="pln">cluster </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">KMeans</span></code></li><li class="L2"><code class="language-python"><span class="pln">k_means </span><span class="pun">=</span><span class="pln"> </span><span class="typ">KMeans</span><span class="pun">(</span><span class="pln">n_clusters</span><span class="pun">=</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> random_state</span><span class="pun">=</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span></code></li><li class="L3"><code class="language-python"><span class="pln">k_means</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">X</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">y_pred </span><span class="pun">=</span><span class="pln"> k_means</span><span class="pun">.</span><span class="pln">predict</span><span class="pun">(</span><span class="pln">X</span><span class="pun">)</span></code></li><li class="L5"><code class="language-python"></code></li><li class="L6"><code class="language-python"><span class="pln">pl</span><span class="pun">.</span><span class="pln">scatter</span><span class="pun">(</span><span class="pln">X_reduced</span><span class="pun">[:,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">],</span><span class="pln"> X_reduced</span><span class="pun">[:,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> c</span><span class="pun">=</span><span class="pln">y_pred</span><span class="pun">,</span></code></li><li class="L7"><code class="language-python"><span class="pln">           cmap</span><span class="pun">=</span><span class="str">'RdYlBu'</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="ztrb"><img src="http://static.zybuluo.com/ronaldhan/lzk9mn6m697llr61yipt1vx1/output_6_0.png" alt="output_6_0.png-22.3kB" title=""></p><p data-anchor-id="y4lv">为了看清楚k-means算法是如何工作的，我们先不为点着色。</p><div class="md-section-divider"></div><pre style="" data-anchor-id="ekzf" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">from</span><span class="pln"> sklearn</span><span class="pun">.</span><span class="pln">datasets</span><span class="pun">.</span><span class="pln">samples_generator </span><span class="kwd">import</span><span class="pln"> make_blobs</span></code></li><li class="L1"><code class="language-python"><span class="pln">X</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> make_blobs</span><span class="pun">(</span><span class="pln">n_samples</span><span class="pun">=</span><span class="lit">300</span><span class="pun">,</span><span class="pln"> centers</span><span class="pun">=</span><span class="lit">4</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">                  random_state</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> cluster_std</span><span class="pun">=</span><span class="lit">0.60</span><span class="pun">)</span></code></li><li class="L3"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">scatter</span><span class="pun">(</span><span class="pln">X</span><span class="pun">[:,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">],</span><span class="pln"> X</span><span class="pun">[:,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> s</span><span class="pun">=</span><span class="lit">50</span><span class="pun">);</span></code></li><li class="L4"><code class="language-python"><span class="com">#这里面的s参数，控制的是图中点的大小</span></code></li></ol></pre><p data-anchor-id="d8aq"><img src="http://static.zybuluo.com/ronaldhan/v3tb2g4u0xxm8ninayaj87kr/output_8_0.png" alt="output_8_0.png-19.3kB" title=""></p><p data-anchor-id="51kn">查看样例数据的基本统计量</p><div class="md-section-divider"></div><pre style="" data-anchor-id="fas6" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">t </span><span class="pun">=</span><span class="pln"> X</span><span class="pun">[:,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">]</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="kwd">print</span><span class="pln"> t</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(),</span><span class="pln"> t</span><span class="pun">.</span><span class="pln">min</span><span class="pun">(),</span><span class="pln"> t</span><span class="pun">.</span><span class="pln">mean</span><span class="pun">(),</span><span class="pln"> t</span><span class="pun">.</span><span class="pln">std</span><span class="pun">()</span></code></li><li class="L3"><code class="language-python"><span class="kwd">print</span><span class="pln"> y</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(),</span><span class="pln"> y</span><span class="pun">.</span><span class="pln">min</span><span class="pun">(),</span><span class="pln"> y</span><span class="pun">.</span><span class="pln">mean</span><span class="pun">(),</span><span class="pln"> y</span><span class="pun">.</span><span class="pln">std</span><span class="pun">()</span></code></li></ol></pre><pre data-anchor-id="2wk3"><code>3.43761754004 -3.12240735602 -0.00632762845008 1.63327104057
3 0 1.5 1.11803398875
</code></pre><p data-anchor-id="liqf">通过观察可以看到，生成的数据有4个聚类，如果通过穷举搜索找到归属于每个聚类的点，时间复杂度是指数级别的，但是一般都通过<em>Expectation Maximization (EM)</em>来找到聚类点。</p><div class="md-section-divider"></div><pre style="" data-anchor-id="0cy6" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">from</span><span class="pln"> sklearn</span><span class="pun">.</span><span class="pln">cluster </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">KMeans</span></code></li><li class="L1"><code class="language-python"><span class="pln">est </span><span class="pun">=</span><span class="pln"> </span><span class="typ">KMeans</span><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span><span class="pln">  </span><span class="com"># 4 clusters</span></code></li><li class="L2"><code class="language-python"><span class="pln">est</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">X</span><span class="pun">)</span></code></li><li class="L3"><code class="language-python"><span class="pln">y_kmeans </span><span class="pun">=</span><span class="pln"> est</span><span class="pun">.</span><span class="pln">predict</span><span class="pun">(</span><span class="pln">X</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">plt</span><span class="pun">.</span><span class="pln">scatter</span><span class="pun">(</span><span class="pln">X</span><span class="pun">[:,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">],</span><span class="pln"> X</span><span class="pun">[:,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> c</span><span class="pun">=</span><span class="pln">y_kmeans</span><span class="pun">,</span><span class="pln"> s</span><span class="pun">=</span><span class="lit">50</span><span class="pun">,</span><span class="pln"> cmap</span><span class="pun">=</span><span class="str">'rainbow'</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="7yjp"><img src="http://static.zybuluo.com/ronaldhan/pfuz6j5iw4pkigfvwvwwg0oo/output_11_0.png" alt="output_11_0.png-43.1kB" title=""> <br>
可以看出，k-means算法准确地找到了数据中的4个聚类。 <br>
k-means算法在不同的数据集上是否收敛并没有保证，一般而言，scikit-learn会随机选择较大的值作为初始值，并逐步找到最好的结果。算法需要事先设置聚类的数量，而在另外一些聚类算法中并不需要如此。</p></div>
</body>
</html>